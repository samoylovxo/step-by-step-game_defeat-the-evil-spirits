!function(){"use strict";var t,e={4902:function(){function t(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){s=!0,i=t},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw i}}}}function r(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function r(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}var n,o,i;return n=r,i=[{key:"showError",value:function(t){alert(t)}},{key:"showMessage",value:function(t){alert(t)}}],(o=[{key:"bindToDOM",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}},{key:"drawUi",value:function(t){var e,r,n=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(function(t){return n.onNewGameClick(t)})),this.saveGameEl.addEventListener("click",(function(t){return n.onSaveGameClick(t)})),this.loadGameEl.addEventListener("click",(function(t){return n.onLoadGameClick(t)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(var a=0;a<Math.pow(this.boardSize,2);a+=1){var o=document.createElement("div");o.classList.add("cell","map-tile","map-tile-".concat((e=a,r=this.boardSize,e<r-1&&e>0?"top":0===e?"top-left":e===r-1?"top-right":e===Math.pow(r,2)-8?"bottom-left":e===Math.pow(r,2)-1?"bottom-right":e/2%4==0&&e!==Math.pow(r,2)-8?"left":e%8==7&&e!==Math.pow(r,2)-1?"right":e>Math.pow(r,2)-8&&e!==Math.pow(r,2)-1?"bottom":"center"))),o.addEventListener("mouseenter",(function(t){return n.onCellEnter(t)})),o.addEventListener("mouseleave",(function(t){return n.onCellLeave(t)})),o.addEventListener("click",(function(t){return n.onCellClick(t)})),this.boardEl.appendChild(o)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(t){var r,n=e(this.cells);try{for(n.s();!(r=n.n()).done;)r.value.innerHTML=""}catch(t){n.e(t)}finally{n.f()}var a,o,i=e(t);try{for(i.s();!(a=i.n()).done;){var c=a.value,s=this.boardEl.children[c.position],l=document.createElement("div");l.classList.add("character",c.character.type);var u=document.createElement("div");u.classList.add("health-level");var h=document.createElement("div");h.classList.add("health-level-indicator","health-level-indicator-".concat((o=c.character.health)<15?"critical":o<50?"normal":"high")),h.style.width="".concat(c.character.health,"%"),u.appendChild(h),l.appendChild(u),s.appendChild(l)}}catch(t){i.e(t)}finally{i.f()}}},{key:"addCellEnterListener",value:function(t){this.cellEnterListeners.push(t)}},{key:"addCellLeaveListener",value:function(t){this.cellLeaveListeners.push(t)}},{key:"addCellClickListener",value:function(t){this.cellClickListeners.push(t)}},{key:"addNewGameListener",value:function(t){this.newGameListeners.push(t)}},{key:"addSaveGameListener",value:function(t){this.saveGameListeners.push(t)}},{key:"addLoadGameListener",value:function(t){this.loadGameListeners.push(t)}},{key:"onCellEnter",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellLeave",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellClick",value:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onNewGameClick",value:function(t){t.preventDefault(),this.newGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onSaveGameClick",value:function(t){t.preventDefault(),this.saveGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onLoadGameClick",value:function(t){t.preventDefault(),this.loadGameListeners.forEach((function(t){return t.call(null)}))}},{key:"selectCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected","selected-".concat(e))}},{key:"deselectCell",value:function(e){var r,n=this.cells[e];(r=n.classList).remove.apply(r,t(Array.from(n.classList).filter((function(t){return t.startsWith("selected")}))))}},{key:"showCellTooltip",value:function(t,e){this.cells[e].title=t}},{key:"hideCellTooltip",value:function(t){this.cells[t].title=""}},{key:"showDamage",value:function(t,e){var r=this;return new Promise((function(n){var a=r.cells[t],o=document.createElement("span");o.textContent=e,o.classList.add("damage"),a.appendChild(o),o.addEventListener("animationend",(function(){a.removeChild(o),n()}))}))}},{key:"setCursor",value:function(t){this.boardEl.style.cursor=t}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}])&&a(n.prototype,o),i&&a(n,i),r}(),i=regeneratorRuntime.mark(c);function c(t,e){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=0;case 1:if(!(r<t.length)){n.next=7;break}return n.next=4,new t[r](e);case 4:r++,n.next=1;break;case 7:case"end":return n.stop()}}),i)}function s(t,e,r){for(var n,a=[],o=0;o<t.length;o++)a.push(new t[o](e));return(n=a,n.sort((function(){return Math.random()-.5}))).splice(0,r)}var l={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"};function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var h=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(u(this,t),this.level=e,this.attack=0,this.defence=0,this.health=50,this.type=r,(this instanceof t?this.constructor:void 0)===t)throw new Error("Нельзя создавать больше одного экземпляров")};var f=function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof h))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=e,this.position=r};function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v(t);if(e){var a=v(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return p(this,r)}}function p(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(r,t);var e=m(r);function r(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,t,"bowman")).attack=25,n.defence=25,n.moveDistance=2,n.attackDistance=2,n}return r}(h);function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=k(t);if(e){var a=k(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return P(this,r)}}function P(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(r,t);var e=C(r);function r(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,t,"daemon")).attack=10,n.defence=40,n.moveDistance=1,n.attackDistance=4,n}return r}(h);function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){return(E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function L(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=B(t);if(e){var a=B(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return x(this,r)}}function x(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}(r,t);var e=L(r);function r(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,t,"magician")).attack=10,n.defence=40,n.moveDistance=1,n.attackDistance=4,n}return r}(h);function M(t){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){return(j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=A(t);if(e){var a=A(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return G(this,r)}}function G(t,e){return!e||"object"!==M(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}(r,t);var e=_(r);function r(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,t,"swordsman")).attack=40,n.defence=10,n.moveDistance=4,n.attackDistance=1,n}return r}(h);function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function D(t,e){return(D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=X(t);if(e){var a=X(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return U(this,r)}}function U(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&D(t,e)}(r,t);var e=N(r);function r(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,t,"undead")).attack=40,n.defence=10,n.moveDistance=4,n.attackDistance=1,n}return r}(h);function F(t){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function H(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=$(t);if(e){var a=$(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return J(this,r)}}function J(t,e){return!e||"object"!==F(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function $(t){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var W=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(r,t);var e=H(r);function r(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,t,"vampire")).attack=25,n.defence=25,n.moveDistance=2,n.attackDistance=2,n}return r}(h);function K(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Q=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.teamPlayer=[],this.teamBot=[]}var e,r,n;return e=t,(r=[{key:"charAddToPlayer",value:function(t){this.teamPlayer.push(t)}},{key:"charAddToBot",value:function(t){this.teamBot.push(t)}}])&&K(e.prototype,r),n&&K(e,n),t}(),V={auto:"auto",pointer:"pointer",crosshair:"crosshair",notallowed:"not-allowed"};function Y(t){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var tt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,n=[{key:"from",value:function(t){return"object"===Y(t)?t:null}}],(r=null)&&Z(e.prototype,r),n&&Z(e,n),t}();function et(t){return function(t){if(Array.isArray(t))return nt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||rt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rt(t,e){if(t){if("string"==typeof t)return nt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?nt(t,e):void 0}}function nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function at(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ot=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gamePlay=e,this.stateService=r,this.allCharactersPlayer=[b,I,R],this.allCharactersBot=[O,z,W],this.team=new Q,this.boardPlayer=[],this.boardBot=[],this.charactersOnBoard=[],this.level=1,this.score=0,this.activePlayer}var e,r,n;return e=t,(r=[{key:"getRandomNum",value:function(t,e){return Math.floor(t+Math.random()*(e+1-t))}},{key:"getRandomItemFromArray",value:function(t){return t[Math.floor(Math.random()*t.length)]}},{key:"mockForCharactersConverting",value:function(t){return et(c(t,0))}},{key:"createBoards",value:function(){for(var t=0;t<this.gamePlay.cells.length;t++)t/2%4!=0&&t%8!=1||this.boardPlayer.push(t),t%8!=7&&t%8!=6||this.boardBot.push(t)}},{key:"addCharsToBoard",value:function(t,e){var r=this;t.forEach((function(t){return r.team.teamPlayer.push(new f(t,r.getRandomItemFromArray(r.boardPlayer)))})),e.forEach((function(t){return r.team.teamBot.push(new f(t,r.getRandomItemFromArray(r.boardBot)))})),this.charactersOnBoard=[].concat(et(this.team.teamPlayer),et(this.team.teamBot))}},{key:"createAllCharacters",value:function(){var t=et(c([b,I],1)),e=s(this.allCharactersBot,this.getRandomNum(1,4),2);this.addCharsToBoard(t,e)}},{key:"init",value:function(){this.gamePlay.drawUi(l.prairie),this.createBoards(),this.createAllCharacters(),this.gamePlay.redrawPositions(this.charactersOnBoard),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addNewGameListener(this.clickNewGame.bind(this)),this.gamePlay.addSaveGameListener(this.clickSaveGame.bind(this)),this.gamePlay.addLoadGameListener(this.clickLoadGame.bind(this))}},{key:"canGoMove",value:function(){for(var t=this.gamePlay.boardSize,e=[],r=[],n=[],a=0,o=0,i=0;a<Math.pow(t,2)-1;a++,o++,i++)a!==t-7&&a!==t-1&&a!==t&&a!==t+1||e.push(a),o!==t-2&&o!==t+2&&o!==2*t-1&&o!==2*t+1||r.push(o),i!==t-3&&i!==t+3&&i!==t-5&&i!==t+5&&i!==2*t+3&&i!==3*t-3&&i!==3*t-2&&i!==3*t-1&&i!==3*t&&i!==3*t+1&&i!==3*t+2&&i!==3*t+3||n.push(i);return{distX1:et(new Set(e)),distX2:et(new Set([].concat(e,et(e.map((function(t){return 2*t}))),r))),distX4:et(new Set([].concat(e,et(e.map((function(t){return 2*t}))),r,n)))}}},{key:"toAttack",value:function(t,e,r){var n=this,a=Math.max(e.character.attack-r.defence,.1*e.character.attack);r.health-=a,this.canAttackBoolean=!1,this.selectCharacter=null,r.health<=0&&(r.health=0,this.charactersOnBoard=this.charactersOnBoard.filter((function(e){return e.position!==t}))),this.gamePlay.showDamage(t,a).then((function(){n.checkStatusGame(),n.gamePlay.redrawPositions(n.charactersOnBoard)}))}},{key:"checkAttack",value:function(t){"undead"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type&&"swordsman"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type||this.setMechanicsAttack(t,this.canGoMove(this.indexSelectedCharacter).distX4),"bowman"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type&&"vampire"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type||this.setMechanicsAttack(t,this.canGoMove(this.indexSelectedCharacter).distX2),"magician"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type&&"daemon"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type||this.setMechanicsAttack(t,this.canGoMove(this.indexSelectedCharacter).distX1)}},{key:"setMechanicsAttack",value:function(t,e){var r=this,n=this.indexSelectedCharacter;if(this.findCharacterIndex(t))for(var a=this.team.teamBot.some((function(e){return e.character===r.findCharacterIndex(t).character})),o=0;o<e.length;o++)(n===t-e[o]||n===t+e[o]&&a)&&(this.canAttackBoolean=!0)}},{key:"checkDistance",value:function(t){"undead"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type&&"swordsman"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type||this.setMechanicsMove(t,this.canGoMove(this.indexSelectedCharacter).distX1),"bowman"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type&&"vampire"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type||this.setMechanicsMove(t,this.canGoMove(this.indexSelectedCharacter).distX2),"magician"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type&&"daemon"!==this.findCharacterIndex(this.indexSelectedCharacter).character.type||this.setMechanicsMove(t,this.canGoMove(this.indexSelectedCharacter).distX4)}},{key:"setMechanicsMove",value:function(t,e){var r=this,n=this.indexSelectedCharacter;this.gamePlay.setCursor(V.notallowed);for(var a=0;a<e.length;a++)n!==t-e[a]&&n!==t+e[a]||(this.gamePlay.setCursor(V.pointer),this.gamePlay.selectCell(t,"green"));this.gamePlay.cells.forEach((function(t,e){for(var n=0;n<r.boardBot.length;n++)r.gamePlay.deselectCell(r.boardBot[n]),e===r.boardBot[n]&&0===t.children.length&&(t.style.cursor="not-allowed")}))}},{key:"findCharacterIndex",value:function(t){return this.charactersOnBoard.find((function(e){return e.position===t}))}},{key:"findCharacterType",value:function(t){var e=this;return this.team.teamPlayer.some((function(r){return e.findCharacterIndex(t).character.type===r.character.type}))}},{key:"onCellClick",value:function(t){var e=this;if(this.findCharacterIndex(t)){var r=this.team.teamBot.some((function(r){return r.character===e.findCharacterIndex(t).character}));if(this.canAttackBoolean&&r)return this.gamePlay.deselectCell(this.indexSelectedCharacter),this.toAttack(t,this.selectCharacter,this.findCharacterIndex(t).character),void(this.activePlayer=1);if(r)return void o.showError("Это не ваш персонаж")}var n=this.gamePlay.cells.find((function(t){return t.classList.contains("selected-green")}));if(this.gamePlay.cells.forEach((function(t,r){return e.gamePlay.deselectCell(r)})),this.selectCharacter&&n&&!this.findCharacterIndex(t))return this.selectCharacter.position=t,this.gamePlay.redrawPositions(this.charactersOnBoard),void(this.selectCharacter=null);this.team.teamPlayer.forEach((function(r){r.position===t&&e.gamePlay.selectCell(t)})),this.indexSelectedCharacter=t,this.selectCharacter=this.findCharacterIndex(t),this.canAttackBoolean&&1===this.activePlayer&&this.autoAttackBot()}},{key:"onCellEnter",value:function(t){var e=this;this.findCharacterIndex(this.indexSelectedCharacter)&&(this.checkDistance(t),this.checkAttack(t)),this.gamePlay.cells.forEach((function(r,n){if(n===t&&r.children.length>0){var a=e.charactersOnBoard.find((function(t){return t.character.type===r.children[0].classList[1]}));e.gamePlay.setCursor(V.pointer),e.gamePlay.showCellTooltip("🎖".concat(a.character.level," ⚔").concat(a.character.attack," 🛡").concat(a.character.defence," ❤").concat(a.character.health),t)}})),this.findCharacterIndex(t)&&!this.findCharacterType(t)&&(this.gamePlay.selectCell(t,"red"),this.gamePlay.setCursor(V.crosshair))}},{key:"onCellLeave",value:function(t){this.gamePlay.setCursor(V.auto),this.gamePlay.hideCellTooltip(t);var e=this.gamePlay.cells.findIndex((function(t){return t.classList.contains("selected-red")})),r=this.gamePlay.cells.findIndex((function(t){return t.classList.contains("selected-green")})),n=this.gamePlay.cells.findIndex((function(t){return t.classList.contains("selected-yellow")}));-1!==e&&this.gamePlay.deselectCell(e),-1!==r&&this.gamePlay.deselectCell(r),-1!==n&&this.selectCharacter&&(this.gamePlay.deselectCell(n),this.gamePlay.selectCell(this.indexSelectedCharacter))}},{key:"newLevel",value:function(){var t=this.gamePlay.boardSize;if(2===this.level){var e,r=[],n=[];this.gamePlay.drawUi(l.desert);for(var a=s(this.allCharactersPlayer,1,this.team.teamPlayer.length),o=0;o<a.length;o++)r.push(new f(a[o],this.getRandomNum(0,Math.pow(t,2)-1)));for(var i=s(this.allCharactersBot,this.getRandomNum(1,2),this.team.teamPlayer.length),c=0;c<i.length;c++)n.push(new f(i[c],this.getRandomNum(0,Math.pow(t,2)-1)));this.team.teamBot=n,(e=this.team.teamPlayer).push.apply(e,r),this.charactersOnBoard=[].concat(n,[].concat(et(this.team.teamPlayer),r)),this.gamePlay.redrawPositions(this.charactersOnBoard)}if(3===this.level){var u,h=[],d=[];this.gamePlay.drawUi(l.arctic);for(var y=s(this.allCharactersPlayer,this.getRandomNum(1,2),2),m=0;m<y.length;m++)h.push(new f(y[m],this.getRandomNum(0,Math.pow(t,2)-1)));for(var p=s(this.allCharactersBot,this.getRandomNum(1,3),this.team.teamPlayer.length),v=0;v<p.length;v++)d.push(new f(p[v],this.getRandomNum(0,Math.pow(t,2)-1)));this.team.teamBot=d,(u=this.team.teamPlayer).push.apply(u,h),this.charactersOnBoard=[].concat(d,[].concat(et(this.team.teamPlayer),h)),this.gamePlay.redrawPositions(this.charactersOnBoard)}if(4===this.level){var b,w=[],g=[];this.gamePlay.drawUi(l.mountain);for(var C=s(this.allCharactersPlayer,this.getRandomNum(1,3),2),P=0;P<C.length;P++)w.push(new f(C[P],this.getRandomNum(0,Math.pow(t,2)-1)));for(var k=s(this.allCharactersBot,this.getRandomNum(1,4),this.team.teamPlayer.length),O=0;O<k.length;O++)g.push(new f(k[O],this.getRandomNum(0,Math.pow(t,2)-1)));this.team.teamBot=g,(b=this.team.teamPlayer).push.apply(b,w),this.charactersOnBoard=[].concat(g,[].concat(et(this.team.teamPlayer),w)),this.gamePlay.redrawPositions(this.charactersOnBoard)}}},{key:"checkStatusGame",value:function(){if(this.teamBot=this.charactersOnBoard.filter((function(t){return["vampire","undead","daemon"].includes(t.character.type)})),this.teamPlayer=this.charactersOnBoard.filter((function(t){return["bowman","swordsman","magician"].includes(t.character.type)})),0===this.teamPlayer.length&&(o.showMessage("Вы проиграли("),this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[]),0===this.teamBot.length&&this.level>=4&&(o.showMessage("Вы выиграли!"),this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[]),0===this.teamBot.length){this.level+=1;var t,e=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=rt(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}(this.team.teamPlayer);try{for(e.s();!(t=e.n()).done;){var r=t.value;this.score+=r.character.health,r.character.level+=1,r.character.health+=80,r.character.health>=100&&(r.character.health=100),r.character.attack=Math.max(r.character.attack,r.character.attack*(1.8-r.character.health/100)),r.character.defence=Math.max(r.character.defence,r.character.defence*(1.8-r.character.health/100))}}catch(t){e.e(t)}finally{e.f()}this.newLevel()}}},{key:"autoAttackBot",value:function(){var t=this,e=this.gamePlay.boardSize,r=this.getRandomItemFromArray(this.team.teamPlayer),n=this.getRandomItemFromArray(this.team.teamBot);this.activePlayer=1,this.team.teamBot.forEach((function(r){r.position=t.getRandomNum(0,Math.pow(e,2)-1)})),this.toAttack(r.position,n,r.character)}},{key:"clickNewGame",value:function(){this.charactersOnBoard=[],this.level=1,this.score=0,this.activePlayer=0,this.team.teamPlayer=[],this.team.teamBot=[],this.gamePlay.drawUi(l.prairie),this.createAllCharacters(),this.gamePlay.redrawPositions(this.charactersOnBoard)}},{key:"clickSaveGame",value:function(){var t={level:this.level,score:this.score,activePlayer:this.activePlayer,position:this.charactersOnBoard},e=tt.from(t);this.stateService.save(e),o.showMessage("Сохранено")}},{key:"clickLoadGame",value:function(){var t=this.stateService.load();if(t){switch(this.level=t.level,this.score=t.score,this.activePlayer=t.activePlayer,this.charactersOnBoard=t.position,t.level){case 1:this.gamePlay.drawUi(l.prairie);break;case 2:this.gamePlay.drawUi(l.desert);break;case 3:this.gamePlay.drawUi(l.arctic);break;case 4:this.gamePlay.drawUi(l.mountain);break;default:this.gamePlay.drawUi(l.prairie)}this.gamePlay.redrawPositions(this.charactersOnBoard)}else o.showMessage("Ошибка загрузки")}}])&&at(e.prototype,r),n&&at(e,n),t}();function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ct=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=e}var e,r,n;return e=t,(r=[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}])&&it(e.prototype,r),n&&it(e,n),t}(),st=new o;st.bindToDOM(document.querySelector("#game-container")),new ot(st,new ct(localStorage)).init()}},r={};function n(t){var a=r[t];if(void 0!==a)return a.exports;var o=r[t]={exports:{}};return e[t](o,o.exports,n),o.exports}n.m=e,t=[],n.O=function(e,r,a,o){if(!r){var i=1/0;for(u=0;u<t.length;u++){r=t[u][0],a=t[u][1],o=t[u][2];for(var c=!0,s=0;s<r.length;s++)(!1&o||i>=o)&&Object.keys(n.O).every((function(t){return n.O[t](r[s])}))?r.splice(s--,1):(c=!1,o<i&&(i=o));if(c){t.splice(u--,1);var l=a();void 0!==l&&(e=l)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[r,a,o]},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var t={179:0};n.O.j=function(e){return 0===t[e]};var e=function(e,r){var a,o,i=r[0],c=r[1],s=r[2],l=0;for(a in c)n.o(c,a)&&(n.m[a]=c[a]);if(s)var u=s(n);for(e&&e(r);l<i.length;l++)o=i[l],n.o(t,o)&&t[o]&&t[o][0](),t[i[l]]=0;return n.O(u)},r=self.webpackChunk=self.webpackChunk||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}(),n.O(void 0,[202],(function(){return n(1202)}));var a=n.O(void 0,[202],(function(){return n(4902)}));a=n.O(a)}();